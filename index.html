<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Flotilla Simulator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #aaaace;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: 'Courier New', monospace;
            color: #004499;
        }
        
        #gameContainer {
            text-align: center;
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            padding: 10px;
        }
        
        #gameCanvas {
            border: 4px solid #004499;
            background: #0f3460;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
            width: 100%;
            height: auto;
            max-width: 800px;
            touch-action: none;
        }
        
        #hud {
            margin-top: 10px;
            font-size: 16px;
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
            padding: 0 5px;
        }
        
        .stat {
            background: rgba(0, 0, 255, 0.1);
            padding: 8px 12px;
            border: 2px solid #004499;
            border-radius: 5px;
            min-width: 120px;
            text-align: center;
        }
        
        #mobileControls {
            position: absolute;
            bottom: 25%;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        #immunityButton {
            background: rgba(0, 68, 153, 0.9);
            color: white;
            border: 3px solid #004499;
            border-radius: 12px;
            width: 120px;
            height: 45px;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
            pointer-events: auto;
            box-shadow: 0 0 15px rgba(0, 68, 153, 0.5);
            transition: all 0.2s ease;
            animation: pulseAvailable 2s infinite;
        }
        
        #immunityButton:disabled {
            opacity: 0;
            cursor: not-allowed;
            animation: none;
        }
        
        #immunityButton:active {
            transform: scale(0.95);
        }
        
        @keyframes pulseAvailable {
            0% { opacity: 1; box-shadow: 0 0 15px rgba(0, 68, 153, 0.5); }
            50% { opacity: 0.8; box-shadow: 0 0 25px rgba(0, 128, 255, 0.7); }
            100% { opacity: 1; box-shadow: 0 0 15px rgba(0, 68, 153, 0.5); }
        }
        
        @media (max-width: 480px) {
            h1 {
                font-size: 1.5em;
                margin-bottom: 10px;
            }
            .stat {
                font-size: 14px;
                min-width: 100px;
                padding: 5px 8px;
            }
            .controls {
                font-size: 12px;
                margin-top: 10px;
            }

        }
        
        #gameOver {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 40px;
            border: 4px solid #004499;
            display: none;
            z-index: 10;
        }
        
        button {
            background: #004499;
            color: #1a1a2e;
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            font-family: 'Courier New', monospace;
            cursor: pointer;
            margin-top: 20px;
            font-weight: bold;
        }
        
        button:hover {
            background: #0000cc;
        }
        
        h1 {
            margin-bottom: 20px;
            text-shadow: 2px 2px #000;
        }
        
        .controls {
            margin-top: 15px;
            font-size: 14px;
            color: #003399;
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <h1>‚õ¥Ô∏è FLOTILLA SIMULATOR ‚õ¥Ô∏è</h1>
        <canvas id="gameCanvas" width="800" height="600"></canvas>
        <div id="hud">
            <div class="stat">üì∑ Selfies: <span id="selfies">0</span></div>
            <div class="stat">‚òÄÔ∏è Puntos Bronceado: <span id="bronceado">0</span></div>
            <div class="stat">‚ù§Ô∏è Vidas: <span id="lives">3</span></div>
            <div class="stat">üõ°Ô∏è Inmunidad: <span id="immunity">OFF</span></div>
        </div>
        <div class="controls">
            Controles: ‚¨ÖÔ∏è‚û°Ô∏è‚¨ÜÔ∏è‚¨áÔ∏è Mover o toca/arrastra para mover | ESPACIO/bot√≥n: Activar Inmunidad (requiere puntos bronceado)
        </div>
        <div id="mobileControls">
            <button id="immunityButton" disabled>INMUNIDAD üõ°Ô∏è</button>
        </div>
        <div id="gameOver">
            <h2>¬°PARTIDA TERMINADA!</h2>
            <p id="finalScore"></p>
            <button onclick="restartGame()">Jugar de Nuevo</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        let gameState = {
            player: { x: 400, y: 500, width: 80, height: 40, speed: 6 },
            enemies: [],
            selfies: [],
            allyShips: [],
            selfieCount: 0,
            bronceadoPoints: 0,
            lives: 3,
            immune: false,
            immuneTimer: 0,
            gameOver: false,
            score: 0,
            enemySpawnTimer: 0,
            selfieSpawnTimer: 0,
            difficulty: 1,
            enemiesAvoided: 0
        };
        
        const keys = {};
        let lastKeyPressTime = 0;
        let isPointerActive = false;
        let pointerX = 0;
        let pointerY = 0;
        
        function handlePointerMove(e) {
            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;
            
            // Get pointer position (mouse or touch)
            const clientX = e.clientX || (e.touches && e.touches[0] ? e.touches[0].clientX : pointerX);
            const clientY = e.clientY || (e.touches && e.touches[0] ? e.touches[0].clientY : pointerY);
            
            pointerX = (clientX - rect.left) * scaleX;
            pointerY = (clientY - rect.top) * scaleY;
            isPointerActive = true;
        }
        
        function handlePointerEnd() {
            isPointerActive = false;
        }
        
        // Event listeners for mouse and touch
        canvas.addEventListener('mousemove', handlePointerMove);
        canvas.addEventListener('mousedown', handlePointerMove);
        canvas.addEventListener('mouseup', handlePointerEnd);
        canvas.addEventListener('mouseleave', handlePointerEnd);
        canvas.addEventListener('touchstart', handlePointerMove);
        canvas.addEventListener('touchmove', handlePointerMove);
        canvas.addEventListener('touchend', handlePointerEnd);
        
        // Crear im√°genes
        const images = {
            instagramLogo: null,
            playerShip: null,
            enemyShip: null,
            allyShipSpain: null,
            allyShipItaly: null,
            camera: null
        };
        
        // Crear logo de Instagram
		function createInstagramLogo() {
			const canvas = document.createElement('canvas');
			canvas.width = 40;
			canvas.height = 40;
			const ctx = canvas.getContext('2d');

			// SVG oficial de Instagram en base64 (40x40, con gradiente)
			const svgBase64 ="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4bWxuczpzb2RpcG9kaT0iaHR0cDovL3NvZGlwb2RpLnNvdXJjZWZvcmdlLm5ldC9EVEQvc29kaXBvZGktMC5kdGQiIHhtbG5zOmlua3NjYXBlPSJodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy9uYW1lc3BhY2VzL2lua3NjYXBlIiB3aWR0aD0iMTAwMCIgaGVpZ2h0PSIxMDAwIiB2aWV3Qm94PSIwIDAgMjY0LjU4MzMgMjY0LjU4MzMiIGlua3NjYXBlOnZlcnNpb249IjEuMC4xICgzYmMyZTgxM2Y1LCAyMDIwLTA5LTA3KSIgc29kaXBvZGk6ZG9jbmFtZT0iSW5zdGFncmFtXygyMDIyKS5zdmciPjxkZWZzPjxyYWRpYWxHcmFkaWVudCBpZD0iZiIgY3g9IjE1OC40MjkiIGN5PSI1NzguMDg4IiByPSI1Mi4zNTE1IiB4bGluazpocmVmPSIjYSIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIGdyYWRpZW50VHJhbnNmb3JtPSJtYXRyaXgoMCAtNC4wMzQxOCA0LjI4MDE4IDAgLTIzMzIuMjI3MyA5NDIuMjM1NikiIGZ4PSIxNTguNDI5IiBmeT0iNTc4LjA4OCIvPjxyYWRpYWxHcmFkaWVudCBpbmtzY2FwZTpjb2xsZWN0PSJhbHdheXMiIHhsaW5rOmhyZWY9IiNiIiBpZD0iZyIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIGdyYWRpZW50VHJhbnNmb3JtPSJtYXRyaXgoLjY3NDQxIC0xLjE2MjAzIDEuNTEyODMgLjg3ODAxIC04MTQuMzY1NyAtNDcuODM1NCkiIGN4PSIxNzIuNjE0OSIgY3k9IjYwMC42OTI0IiBmeD0iMTcyLjYxNDkiIGZ5PSI2MDAuNjkyNCIgcj0iNjUiLz48cmFkaWFsR3JhZGllbnQgaW5rc2NhcGU6Y29sbGVjdD0iYWx3YXlzIiB4bGluazpocmVmPSIjYyIgaWQ9ImgiIGN4PSIxNDQuMDEyIiBjeT0iNTEuMzM2NyIgZng9IjE0NC4wMTIiIGZ5PSI1MS4zMzY3IiByPSI2Ny4wODEiIGdyYWRpZW50VHJhbnNmb3JtPSJtYXRyaXgoLTIuMzk4OSAuNjc1NDkgLS4yMzAwOCAtLjgxNzMyIDQ2NC45OTU3IC0yNi40MDM1KSIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiLz48cmFkaWFsR3JhZGllbnQgaW5rc2NhcGU6Y29sbGVjdD0iYWx3YXlzIiB4bGluazpocmVmPSIjZCIgaWQ9ImUiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiBncmFkaWVudFRyYW5zZm9ybT0ibWF0cml4KC0zLjEwNzk3IC44NzY1MiAtLjYzMTUgLTIuMjM5MTQgMTM0NS42NTAzIDEzNzQuMTk4MykiIGN4PSIxOTkuNzg4NCIgY3k9IjYyOC40Mzc5IiBmeD0iMTk5Ljc4ODQiIGZ5PSI2MjguNDM3OSIgcj0iNTIuMzUxNSIvPjxsaW5lYXJHcmFkaWVudCBpbmtzY2FwZTpjb2xsZWN0PSJhbHdheXMiIGlkPSJkIj48c3RvcCBvZmZzZXQ9IjAiIHN0b3AtY29sb3I9IiNmZjAwNWYiLz48c3RvcCBvZmZzZXQ9IjEiIHN0b3AtY29sb3I9IiNmYzAxZDgiLz48L2xpbmVhckdyYWRpZW50PjxsaW5lYXJHcmFkaWVudCBpZD0iYyI+PHN0b3Agb2Zmc2V0PSIwIiBzdG9wLWNvbG9yPSIjNzgwY2ZmIi8+PHN0b3Agc3RvcC1jb2xvcj0iIzgyMGJmZiIgb2Zmc2V0PSIxIiBzdG9wLW9wYWNpdHk9IjAiLz48L2xpbmVhckdyYWRpZW50PjxsaW5lYXJHcmFkaWVudCBpbmtzY2FwZTpjb2xsZWN0PSJhbHdheXMiIGlkPSJiIj48c3RvcCBvZmZzZXQ9IjAiIHN0b3AtY29sb3I9IiNmYzAiLz48c3RvcCBvZmZzZXQ9IjEiIHN0b3AtY29sb3I9IiNmYzAiIHN0b3Atb3BhY2l0eT0iMCIvPjwvbGluZWFyR3JhZGllbnQ+PGxpbmVhckdyYWRpZW50IGlkPSJhIj48c3RvcCBvZmZzZXQ9IjAiIHN0b3AtY29sb3I9IiNmYzAiLz48c3RvcCBvZmZzZXQ9Ii4xMjQyIiBzdG9wLWNvbG9yPSIjZmMwIi8+PHN0b3Agb2Zmc2V0PSIuNTY3MiIgc3RvcC1jb2xvcj0iI2ZlNGEwNSIvPjxzdG9wIG9mZnNldD0iLjY5NDIiIHN0b3AtY29sb3I9IiNmZjBmM2YiLz48c3RvcCBvZmZzZXQ9IjEiIHN0b3AtY29sb3I9IiNmZTA2NTciIHN0b3Atb3BhY2l0eT0iMCIvPjwvbGluZWFyR3JhZGllbnQ+PC9kZWZzPjxzb2RpcG9kaTpuYW1lZHZpZXcgcGFnZWNvbG9yPSIjZmZmZmZmIiBib3JkZXJjb2xvcj0iIzY2NjY2NiIgYm9yZGVyb3BhY2l0eT0iMSIgaW5rc2NhcGU6cGFnZW9wYWNpdHk9IjAiIGlua3NjYXBlOnBhZ2VzaGFkb3c9IjIiIGlua3NjYXBlOnpvb209Ii41MTUiIGlua3NjYXBlOmN4PSI1MDAiIGlua3NjYXBlOmN5PSI1MDAiIGlua3NjYXBlOmRvY3VtZW50LXVuaXRzPSJtbSIgaW5rc2NhcGU6Y3VycmVudC1sYXllcj0ibGF5ZXIxIiBpbmtzY2FwZTpkb2N1bWVudC1yb3RhdGlvbj0iMCIgc2hvd2dyaWQ9ImZhbHNlIiBpbmtzY2FwZTp3aW5kb3ctd2lkdGg9IjEzNjYiIGlua3NjYXBlOndpbmRvdy1oZWlnaHQ9IjcwNSIgaW5rc2NhcGU6d2luZG93LXg9Ii04IiBpbmtzY2FwZTp3aW5kb3cteT0iLTgiIGlua3NjYXBlOndpbmRvdy1tYXhpbWl6ZWQ9IjEiLz48ZyBpbmtzY2FwZTpsYWJlbD0iTGF5ZXIgMSIgaW5rc2NhcGU6Z3JvdXBtb2RlPSJsYXllciI+PHBhdGggZD0iTTIwNC4xNTAzIDE4LjE0MjljLTU1LjIzMDUgMC03MS4zODM0LjA1Ny03NC41MjMyLjMxNzUtMTEuMzM0Mi45NDI0LTE4LjM4NyAyLjcyNzUtMjYuMDcwOCA2LjU1NC01LjkyMTQgMi45NDEzLTEwLjU5MTUgNi4zNTA2LTE1LjIwMDUgMTEuMTI5OC04LjM5MzggOC43MTU3LTEzLjQ4MSAxOS40MzgzLTE1LjMyMjYgMzIuMTg0Mi0uODk1MyA2LjE4NzctMS4xNTU4IDcuNDQ5Ni0xLjIwODcgMzkuMDU1OC0uMDIwMyAxMC41MzU0IDAgMjQuNDAwNyAwIDQyLjk5ODQgMCA1NS4yMDA4LjA2MSA3MS4zNDE4LjMyNTYgNzQuNDc2NC45MTU3IDExLjAzMiAyLjY0NTMgMTcuOTcyOCA2LjMwODEgMjUuNTY1IDcgMTQuNTMyOSAyMC4zNjkgMjUuNDQyOCAzNi4xMTkgMjkuNTEzNyA1LjQ1MzUgMS40MDQ0IDExLjQ3NjcgMi4xNzc5IDE5LjIwOTIgMi41NDQyIDMuMjc2Mi4xNDI1IDM2LjY2ODQuMjQ0MyA3MC4wODEuMjQ0MyAzMy40MTI3IDAgNjYuODI1My0uMDQwNyA3MC4wMi0uMjAzNSA4Ljk1MzUtLjQyMTQgMTQuMTUyNi0xLjExOTUgMTkuOTAxMS0yLjYwNTQgMTUuODUxNy00LjA5MTIgMjguOTc2Ny0xNC44MzgzIDM2LjExOS0yOS41NzQ4IDMuNTkxNi03LjQwOSA1LjQxMjgtMTQuNjE0NCA2LjIzNy0yNS4wNzA0LjE3OS0yLjI3OTYuMjU0My0zOC42MjYzLjI1NDMtNzQuOTI0IDAtMzYuMzA0LS4wODE0LTcyLjU4MzUtLjI2MDUtNzQuODYzMi0uODM0My0xMC42MjQ5LTIuNjU1NS0xNy43NjkyLTYuMzYzLTI1LjMyMDctMy4wNDIxLTYuMTgxNi02LjQyLTEwLjc5OC0xMS4zMjQtMTUuNTE4LTguNzUyLTguMzYxNi0xOS40NTU1LTEzLjQ1MDItMzIuMjEwMS0xNS4yOTAyLTYuMTgtLjg5MzYtNy40MTEtMS4xNTgyLTM5LjAzMy0xLjIxMzF6IiBpbmtzY2FwZTpjb25uZWN0b3ItY3VydmF0dXJlPSIwIiBmaWxsPSJ1cmwoI2UpIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtNzEuODE1NSAtMTguMTQyOSkiLz48cGF0aCBkPSJNMjA0LjE1MDMgMTguMTQyOWMtNTUuMjMwNSAwLTcxLjM4MzQuMDU3LTc0LjUyMzIuMzE3NS0xMS4zMzQyLjk0MjQtMTguMzg3IDIuNzI3NS0yNi4wNzA4IDYuNTU0LTUuOTIxNCAyLjk0MTMtMTAuNTkxNSA2LjM1MDYtMTUuMjAwNSAxMS4xMjk4LTguMzkzOCA4LjcxNTctMTMuNDgxIDE5LjQzODMtMTUuMzIyNiAzMi4xODQyLS44OTUzIDYuMTg3Ny0xLjE1NTggNy40NDk2LTEuMjA4NyAzOS4wNTU4LS4wMjAzIDEwLjUzNTQgMCAyNC40MDA3IDAgNDIuOTk4NCAwIDU1LjIwMDguMDYxIDcxLjM0MTguMzI1NiA3NC40NzY0LjkxNTcgMTEuMDMyIDIuNjQ1MyAxNy45NzI4IDYuMzA4MSAyNS41NjUgNyAxNC41MzI5IDIwLjM2OSAyNS40NDI4IDM2LjExOSAyOS41MTM3IDUuNDUzNSAxLjQwNDQgMTEuNDc2NyAyLjE3NzkgMTkuMjA5MiAyLjU0NDIgMy4yNzYyLjE0MjUgMzYuNjY4NC4yNDQzIDcwLjA4MS4yNDQzIDMzLjQxMjcgMCA2Ni44MjUzLS4wNDA3IDcwLjAyLS4yMDM1IDguOTUzNS0uNDIxNCAxNC4xNTI2LTEuMTE5NSAxOS45MDExLTIuNjA1NCAxNS44NTE3LTQuMDkxMiAyOC45NzY3LTE0LjgzODMgMzYuMTE5LTI5LjU3NDggMy41OTE2LTcuNDA5IDUuNDEyOC0xNC42MTQ0IDYuMjM3LTI1LjA3MDQuMTc5LTIuMjc5Ni4yNTQzLTM4LjYyNjMuMjU0My03NC45MjQgMC0zNi4zMDQtLjA4MTQtNzIuNTgzNS0uMjYwNS03NC44NjMyLS44MzQzLTEwLjYyNDktMi42NTU1LTE3Ljc2OTItNi4zNjMtMjUuMzIwNy0zLjA0MjEtNi4xODE2LTYuNDItMTAuNzk4LTExLjMyNC0xNS41MTgtOC43NTItOC4zNjE2LTE5LjQ1NTUtMTMuNDUwMi0zMi4yMTAxLTE1LjI5MDItNi4xOC0uODkzNi03LjQxMS0xLjE1ODItMzkuMDMzLTEuMjEzMXoiIGlua3NjYXBlOmNvbm5lY3Rvci1jdXJ2YXR1cmU9IjAiIGZpbGw9InVybCgjZikiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC03MS44MTU1IC0xOC4xNDI5KSIvPjxwYXRoIGQ9Ik0yMDQuMTUwMyAxOC4xNDI5Yy01NS4yMzA1IDAtNzEuMzgzNC4wNTctNzQuNTIzMi4zMTc1LTExLjMzNDIuOTQyNC0xOC4zODcgMi43Mjc1LTI2LjA3MDggNi41NTQtNS45MjE0IDIuOTQxMy0xMC41OTE1IDYuMzUwNi0xNS4yMDA1IDExLjEyOTgtOC4zOTM4IDguNzE1Ny0xMy40ODEgMTkuNDM4My0xNS4zMjI2IDMyLjE4NDItLjg5NTMgNi4xODc3LTEuMTU1OCA3LjQ0OTYtMS4yMDg3IDM5LjA1NTgtLjAyMDMgMTAuNTM1NCAwIDI0LjQwMDcgMCA0Mi45OTg0IDAgNTUuMjAwOC4wNjEgNzEuMzQxOC4zMjU2IDc0LjQ3NjQuOTE1NyAxMS4wMzIgMi42NDUzIDE3Ljk3MjggNi4zMDgxIDI1LjU2NSA3IDE0LjUzMjkgMjAuMzY5IDI1LjQ0MjggMzYuMTE5IDI5LjUxMzcgNS40NTM1IDEuNDA0NCAxMS40NzY3IDIuMTc3OSAxOS4yMDkyIDIuNTQ0MiAzLjI3NjIuMTQyNSAzNi42Njg0LjI0NDMgNzAuMDgxLjI0NDMgMzMuNDEyNyAwIDY2LjgyNTMtLjA0MDcgNzAuMDItLjIwMzUgOC45NTM1LS40MjE0IDE0LjE1MjYtMS4xMTk1IDE5LjkwMTEtMi42MDU0IDE1Ljg1MTctNC4wOTEyIDI4Ljk3NjctMTQuODM4MyAzNi4xMTktMjkuNTc0OCAzLjU5MTYtNy40MDkgNS40MTI4LTE0LjYxNDQgNi4yMzctMjUuMDcwNC4xNzktMi4yNzk2LjI1NDMtMzguNjI2My4yNTQzLTc0LjkyNCAwLTM2LjMwNC0uMDgxNC03Mi41ODM1LS4yNjA1LTc0Ljg2MzItLjgzNDMtMTAuNjI0OS0yLjY1NTUtMTcuNzY5Mi02LjM2My0yNS4zMjA3LTMuMDQyMS02LjE4MTYtNi40Mi0xMC43OTgtMTEuMzI0LTE1LjUxOC04Ljc1Mi04LjM2MTYtMTkuNDU1NS0xMy40NTAyLTMyLjIxMDEtMTUuMjkwMi02LjE4LS44OTM2LTcuNDExLTEuMTU4Mi0zOS4wMzMtMS4yMTMxeiIgaW5rc2NhcGU6Y29ubmVjdG9yLWN1cnZhdHVyZT0iMCIgZmlsbD0idXJsKCNnKSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTcxLjgxNTUgLTE4LjE0MjkpIi8+PHBhdGggZD0iTTIwNC4xNTAzIDE4LjE0MjljLTU1LjIzMDUgMC03MS4zODM0LjA1Ny03NC41MjMyLjMxNzUtMTEuMzM0Mi45NDI0LTE4LjM4NyAyLjcyNzUtMjYuMDcwOCA2LjU1NC01LjkyMTQgMi45NDEzLTEwLjU5MTUgNi4zNTA2LTE1LjIwMDUgMTEuMTI5OC04LjM5MzggOC43MTU3LTEzLjQ4MSAxOS40MzgzLTE1LjMyMjYgMzIuMTg0Mi0uODk1MyA2LjE4NzctMS4xNTU4IDcuNDQ5Ni0xLjIwODcgMzkuMDU1OC0uMDIwMyAxMC41MzU0IDAgMjQuNDAwNyAwIDQyLjk5ODQgMCA1NS4yMDA4LjA2MSA3MS4zNDE4LjMyNTYgNzQuNDc2NC45MTU3IDExLjAzMiAyLjY0NTMgMTcuOTcyOCA2LjMwODEgMjUuNTY1IDcgMTQuNTMyOSAyMC4zNjkgMjUuNDQyOCAzNi4xMTkgMjkuNTEzNyA1LjQ1MzUgMS40MDQ0IDExLjQ3NjcgMi4xNzc5IDE5LjIwOTIgMi41NDQyIDMuMjc2Mi4xNDI1IDM2LjY2ODQuMjQ0MyA3MC4wODEuMjQ0MyAzMy40MTI3IDAgNjYuODI1My0uMDQwNyA3MC4wMi0uMjAzNSA4Ljk1MzUtLjQyMTQgMTQuMTUyNi0xLjExOTUgMTkuOTAxMS0yLjYwNTQgMTUuODUxNy00LjA5MTIgMjguOTc2Ny0xNC44MzgzIDM2LjExOS0yOS41NzQ4IDMuNTkxNi03LjQwOSA1LjQxMjgtMTQuNjE0NCA2LjIzNy0yNS4wNzA0LjE3OS0yLjI3OTYuMjU0My0zOC42MjYzLjI1NDMtNzQuOTI0IDAtMzYuMzA0LS4wODE0LTcyLjU4MzUtLjI2MDUtNzQuODYzMi0uODM0My0xMC42MjQ5LTIuNjU1NS0xNy43NjkyLTYuMzYzLTI1LjMyMDctMy4wNDIxLTYuMTgxNi02LjQyLTEwLjc5OC0xMS4zMjQtMTUuNTE4LTguNzUyLTguMzYxNi0xOS40NTU1LTEzLjQ1MDItMzIuMjEwMS0xNS4yOTAyLTYuMTgtLjg5MzYtNy40MTEtMS4xNTgyLTM5LjAzMy0xLjIxMzF6IiBpbmtzY2FwZTpjb25uZWN0b3ItY3VydmF0dXJlPSIwIiBmaWxsPSJ1cmwoI2gpIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtNzEuODE1NSAtMTguMTQyOSkiLz48cGF0aCBkPSJNMTMyLjM0NTIgMzMuOTczYy0yNi43MTY3IDAtMzAuMDY5Ni4xMTY3LTQwLjU2MjkuNTkzOS0xMC40NzI3LjQ3OTItMTcuNjIxMiAyLjEzNi0yMy44NzYyIDQuNTY3LTYuNDcwMSAyLjUxMDctMTEuOTU4NiA1Ljg2OTMtMTcuNDI2NSAxMS4zMzUyLTUuNDcyIDUuNDY0LTguODMzMiAxMC45NDgzLTExLjM1NCAxNy40MTE2LTIuNDM4OSA2LjI1MjQtNC4wOTkgMTMuMzk3Ni00LjU3MDMgMjMuODU4NS0uNDY5MyAxMC40ODU0LS41OTIzIDEzLjgzNzktLjU5MjMgNDAuNTM0OCAwIDI2LjY5Ny4xMTg5IDMwLjAzNzEuNTk0MyA0MC41MjI1LjQ4MTcgMTAuNDY1IDIuMTM5NyAxNy42MDgyIDQuNTcwMyAyMy44NTg1IDIuNTE0NyA2LjQ2NTQgNS44NzU4IDExLjk0OTcgMTEuMzQ1OCAxNy40MTM2IDUuNDY2IDUuNDY4IDEwLjk1NDQgOC44MzQ5IDE3LjQyMDQgMTEuMzQ1NiA2LjI1OSAyLjQzMDkgMTMuNDA5NyA0LjA4NzcgMjMuODgwMyA0LjU2NyAxMC40OTMzLjQ3NyAxMy44NDQxLjU5MzggNDAuNTU4OC41OTM4IDI2LjcxODggMCAzMC4wNjE1LS4xMTY3IDQwLjU1NDctLjU5MzkgMTAuNDcyOC0uNDc5MiAxNy42Mjk1LTIuMTM2IDIzLjg4ODUtNC41NjcgNi40NjgxLTIuNTEwNiAxMS45NDg0LTUuODc3NSAxNy40MTQzLTExLjM0NTUgNS40NzItNS40NjM5IDguODMzMi0xMC45NDgyIDExLjM1NC0xNy40MTE1IDIuNDE4My02LjI1MjQgNC4wNzg0LTEzLjM5NzYgNC41NzAzLTIzLjg1ODUuNDcxMy0xMC40ODU0LjU5NDMtMTMuODI3Ny41OTQzLTQwLjUyNDYgMC0yNi42OTctLjEyMy0zMC4wNDczLS41OTQzLTQwLjUzMjgtLjQ5MTktMTAuNDY1LTIuMTUyLTE3LjYwODEtNC41NzAzLTIzLjg1ODQtMi41MjA4LTYuNDY1NC01Ljg4Mi0xMS45NDk4LTExLjM1NC0xNy40MTM3LTUuNDcyMS01LjQ2OC0xMC45NDQyLTguODI2Ni0xNy40MjA0LTExLjMzNTMtNi4yNzE0LTIuNDMwOS0xMy40MjQtNC4wODc3LTIzLjg5NjctNC41NjY5LTEwLjQ5MzMtLjQ3NzItMTMuODMzOS0uNTkzOS00MC41NTg4LS41OTM5em0tOC44MjUgMTcuNzE0N2MyLjYxOTMtLjAwNDEgNS41NDE4IDAgOC44MjUgMCAyNi4yNjU5IDAgMjkuMzc5LjA5NDIgMzkuNzUxMy41NjUyIDkuNTkxNS40MzgzIDE0Ljc5NzEgMi4wMzk3IDE4LjI2NDggMy4zODUyIDQuNTkwOCAxLjc4MTcgNy44NjM4IDMuOTExNiAxMS4zMDQ4IDcuMzUyMSAzLjQ0MzEgMy40NDA2IDUuNTc0NSA2LjcxNzMgNy4zNjE3IDExLjMwNDYgMS4zNDY1IDMuNDYxIDIuOTUxMiA4LjY2MjggMy4zODc3IDE4LjI0NzIuNDcxNCAxMC4zNjI1LjU3MzkgMTMuNDc1NC41NzM5IDM5LjcwOTUgMCAyNi4yMzQtLjEwMjUgMjkuMzQ3LS41NzM5IDM5LjcwOTUtLjQzODYgOS41ODQzLTIuMDQxMiAxNC43ODYxLTMuMzg3NyAxOC4yNDcxLTEuNzgzIDQuNTg3NC0zLjkxODYgNy44NTM5LTcuMzYxNyAxMS4yOTIzLTMuNDQzIDMuNDQwNi02LjcxMiA1LjU3MDQtMTEuMzA0OCA3LjM1MjEtMy40NjM2IDEuMzUxNy04LjY3MzMgMi45NDktMTguMjY0OCAzLjM4NzMtMTAuMzcwMi40NzEtMTMuNDg1NC41NzM0LTM5Ljc1MTMuNTczNC0yNi4yNjc5IDAtMjkuMzgxLS4xMDI0LTM5Ljc1MTMtLjU3MzQtOS41OTE0LS40NDIzLTE0Ljc5Ny0yLjA0MzgtMTguMjY2OC0zLjM4OTMtNC41OTA4LTEuNzgxNy03Ljg3LTMuOTExNi0xMS4zMTMtNy4zNTIxLTMuNDQzMS0zLjQ0MDUtNS41NzQ1LTYuNzA5LTcuMzYxNy0xMS4yOTg1LTEuMzQ2NS0zLjQ2MS0yLjk1MTItOC42NjI4LTMuMzg3Ny0xOC4yNDcxLS40NzE0LTEwLjM2MjYtLjU2NTctMTMuNDc1NC0uNTY1Ny0zOS43MjU5IDAtMjYuMjUwNC4wOTQzLTI5LjM0Ny41NjU3LTM5LjcwOTUuNDM4Ni05LjU4NDQgMi4wNDEyLTE0Ljc4NjEgMy4zODc3LTE4LjI1MTIgMS43ODMtNC41ODc0IDMuOTE4Ni03Ljg2NDEgNy4zNjE3LTExLjMwNDYgMy40NDMtMy40NDA2IDYuNzIyMi01LjU3MDQgMTEuMzEzLTcuMzU2MiAzLjQ2NzctMS4zNTE3IDguNjc1NC0yLjk0OSAxOC4yNjY4LTMuMzg5NCA5LjA3NS0uNDA5NiAxMi41OTE5LS41MzI0IDMwLjkyNjQtLjU1M3ptNjEuMzM2MyAxNi4zMjJjLTYuNTE3MyAwLTExLjgwNSA1LjI3NzYtMTEuODA1IDExLjc5MiAwIDYuNTEyNSA1LjI4NzcgMTEuNzk2MiAxMS44MDUgMTEuNzk2MiA2LjUxNzIgMCAxMS44MDQ5LTUuMjgzNyAxMS44MDQ5LTExLjc5NjIgMC02LjUxMjQtNS4yODc3LTExLjc5Ni0xMS44MDUtMTEuNzk2em0tNTIuNTExMyAxMy43ODI2Yy0yNy44OTkzIDAtNTAuNTE5MSAyMi42MDMxLTUwLjUxOTEgNTAuNDgxNyAwIDI3Ljg3ODYgMjIuNjE5OCA1MC40NzE0IDUwLjUxOTEgNTAuNDcxNHM1MC41MTEtMjIuNTkyOCA1MC41MTEtNTAuNDcxNGMwLTI3Ljg3ODYtMjIuNjEzNy01MC40ODE3LTUwLjUxMy01MC40ODE3em0wIDE3LjcxNDdjMTguMTA5IDAgMzIuNzkxNCAxNC42Njk0IDMyLjc5MTQgMzIuNzY3IDAgMTguMDk1Ni0xNC42ODI0IDMyLjc2Ny0zMi43OTE0IDMyLjc2Ny0xOC4xMTEgMC0zMi43OTEzLTE0LjY3MTQtMzIuNzkxMy0zMi43NjcgMC0xOC4wOTc2IDE0LjY4MDMtMzIuNzY3IDMyLjc5MTMtMzIuNzY3eiIgaW5rc2NhcGU6Y29ubmVjdG9yLWN1cnZhdHVyZT0iMCIgZmlsbD0iI2ZmZiIvPjwvZz48L3N2Zz4=";

			const img = new Image();
			img.onload = function () {
				ctx.clearRect(0, 0, canvas.width, canvas.height);
				ctx.drawImage(img, 0, 0, 40, 40);
			};
			img.src = svgBase64;

			return canvas;
		}
		
		// Crear barco del jugador (humanitario)
        function createPlayerShip() {
            const canvas = document.createElement('canvas');
            canvas.width = 80;
            canvas.height = 60;
            const ctx = canvas.getContext('2d');
            
            // Casco blanco
            ctx.fillStyle = '#ffffff';
            ctx.beginPath();
            ctx.moveTo(40, 10);
            ctx.lineTo(70, 40);
            ctx.lineTo(70, 50);
            ctx.lineTo(10, 50);
            ctx.lineTo(10, 40);
            ctx.closePath();
            ctx.fill();
            
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.stroke();
            
            // Cruz roja
            ctx.fillStyle = '#000000';
            ctx.fillRect(30, 30, 20, 6);
            ctx.fillStyle = '#bbbbbb';
            ctx.fillRect(30, 35, 20, 5);
            ctx.fillStyle = '#00aa00';
            ctx.fillRect(30, 40, 20, 5);

            ctx.fillStyle = '#aa0000';
			ctx.beginPath();
            ctx.moveTo(30, 31);
            ctx.lineTo(40, 38);
            ctx.lineTo(30, 43);
            ctx.fill();
            
            // Ventanas
            ctx.fillStyle = '#87CEEB';
            ctx.fillRect(20, 30, 8, 8);
            ctx.fillRect(52, 30, 8, 8);
            
            // Chimenea
            ctx.fillStyle = '#555';
            ctx.fillRect(35, 15, 10, 10);
            
            return canvas;
        }
        
        // Crear barco enemigo israel√≠
        function createEnemyShip() {
            const canvas = document.createElement('canvas');
            canvas.width = 70;
            canvas.height = 60;
            const ctx = canvas.getContext('2d');
            
            // Casco gris militar
            ctx.fillStyle = '#708090';
            ctx.beginPath();
            ctx.moveTo(35, 45);
            ctx.lineTo(60, 25);
            ctx.lineTo(60, 15);
            ctx.lineTo(10, 15);
            ctx.lineTo(10, 25);
            ctx.closePath();
            ctx.fill();
            
            ctx.strokeStyle = '#2c3e50';
            ctx.lineWidth = 2;
            ctx.stroke();
            
            // Superestructura
            ctx.fillStyle = '#5a6d7e';
            ctx.fillRect(25, 8, 20, 12);
            
            // Ca√±ones
            ctx.fillStyle = '#2c3e50';
            ctx.fillRect(15, 18, 5, 10);
            ctx.fillRect(50, 18, 5, 10);
            
            // Bandera israel√≠ (azul y blanca)
            ctx.fillStyle = '#0038b8';
            ctx.fillRect(40, 3, 15, 2);
            ctx.fillRect(40, 8, 15, 2);
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(40, 5, 15, 3);
            
            // Estrella de David simplificada
            ctx.fillStyle = '#0038b8';
            ctx.beginPath();
            ctx.moveTo(47, 5);
            ctx.lineTo(49, 8);
            ctx.lineTo(45, 8);
            ctx.closePath();
            ctx.fill();
            
            return canvas;
        }
        
        // Crear barco aliado espa√±ol
        function createAllyShipSpain() {
            const canvas = document.createElement('canvas');
            canvas.width = 90;
            canvas.height = 70;
            const ctx = canvas.getContext('2d');
            
            // Casco
            ctx.fillStyle = '#34495e';
            ctx.beginPath();
            ctx.moveTo(45, 10);
            ctx.lineTo(75, 45);
            ctx.lineTo(75, 55);
            ctx.lineTo(15, 55);
            ctx.lineTo(15, 45);
            ctx.closePath();
            ctx.fill();
            
            ctx.strokeStyle = '#1a252f';
            ctx.lineWidth = 2;
            ctx.stroke();
            
            // Torreta
            ctx.fillStyle = '#2c3e50';
            ctx.fillRect(35, 25, 20, 20);
            
            // Ca√±√≥n
            ctx.fillStyle = '#1a252f';
            ctx.fillRect(42, 18, 6, 15);
            
            // Bandera espa√±ola
            ctx.fillStyle = '#c60b1e';
            ctx.fillRect(60, 15, 20, 5);
            ctx.fillStyle = '#ffc400';
            ctx.fillRect(60, 20, 20, 5);
            ctx.fillStyle = '#c60b1e';
            ctx.fillRect(60, 25, 20, 5);
            
            return canvas;
        }
        
        // Crear barco aliado italiano
        function createAllyShipItaly() {
            const canvas = document.createElement('canvas');
            canvas.width = 90;
            canvas.height = 70;
            const ctx = canvas.getContext('2d');
            
            // Casco
            ctx.fillStyle = '#2c3e50';
            ctx.beginPath();
            ctx.moveTo(45, 10);
            ctx.lineTo(75, 45);
            ctx.lineTo(75, 55);
            ctx.lineTo(15, 55);
            ctx.lineTo(15, 45);
            ctx.closePath();
            ctx.fill();
            
            ctx.strokeStyle = '#1a252f';
            ctx.lineWidth = 2;
            ctx.stroke();
            
            // Torreta
            ctx.fillStyle = '#34495e';
            ctx.fillRect(35, 25, 20, 20);
            
            // Ca√±√≥n
            ctx.fillStyle = '#1a252f';
            ctx.fillRect(42, 18, 6, 15);
            
            // Bandera italiana
            ctx.fillStyle = '#009246';
            ctx.fillRect(60, 15, 7, 15);
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(67, 15, 7, 15);
            ctx.fillStyle = '#ce2b37';
            ctx.fillRect(74, 15, 7, 15);
            
            return canvas;
        }
        
        // Crear c√°mara
        function createCamera() {
            const canvas = document.createElement('canvas');
            canvas.width = 30;
            canvas.height = 25;
            const ctx = canvas.getContext('2d');
            
            // Cuerpo de la c√°mara
            ctx.fillStyle = '#333333';
            ctx.fillRect(2, 5, 26, 18);
            ctx.fillStyle = '#555555';
            ctx.fillRect(5, 8, 20, 12);
            
            // Lente
            ctx.fillStyle = '#000000';
            ctx.beginPath();
            ctx.arc(15, 14, 6, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.fillStyle = '#4a9eff';
            ctx.beginPath();
            ctx.arc(15, 14, 4, 0, Math.PI * 2);
            ctx.fill();
            
            // Reflejo en la lente
            ctx.fillStyle = '#ffffff';
            ctx.beginPath();
            ctx.arc(13, 12, 2, 0, Math.PI * 2);
            ctx.fill();
            
            // Flash
            ctx.fillStyle = '#ffff00';
            ctx.fillRect(22, 8, 4, 4);
            
            // Bot√≥n
            ctx.fillStyle = '#ff0000';
            ctx.fillRect(22, 2, 4, 3);
            
            return canvas;
        }
        
        // Inicializar im√°genes
        images.instagramLogo = createInstagramLogo();
        images.playerShip = createPlayerShip();
        images.enemyShip = createEnemyShip();
        images.allyShipSpain = createAllyShipSpain();
        images.allyShipItaly = createAllyShipItaly();
        images.camera = createCamera();
        
        document.addEventListener('keydown', (e) => {
            keys[e.key] = true;
            if (e.key === ' ' && gameState.bronceadoPoints >= 100 + (difficulty * 2) && !gameState.immune) {
                e.preventDefault();
                activateImmunity();
            }
        });
        
        document.addEventListener('keyup', (e) => {
            keys[e.key] = false;
        });
        
        function activateImmunity() {
            gameState.bronceadoPoints -= 100 + (difficulty * 2);
            gameState.immune = true;
            gameState.immuneTimer = 300;
            
            gameState.allyShips.push(
                { x: gameState.player.x - 100, y: gameState.player.y, type: 'spain' },
                { x: gameState.player.x + 100, y: gameState.player.y, type: 'italy' }
            );
            
            updateHUD();
        }
        
        function drawPlayer() {
            ctx.save();
            if (gameState.immune) {
                ctx.globalAlpha = 0.5 + Math.sin(Date.now() / 100) * 0.5;
            }
            ctx.drawImage(images.playerShip, 
                gameState.player.x - 40, 
                gameState.player.y - 25, 
                80, 60);
            ctx.restore();
        }
        
        function drawEnemy(enemy) {
            ctx.drawImage(images.enemyShip, 
                enemy.x - 35, 
                enemy.y - 25, 
                70, 60);
        }
        
        function drawAllyShip(ship) {
            const img = ship.type === 'spain' ? images.allyShipSpain : images.allyShipItaly;
            ctx.drawImage(img, 
                ship.x - 45, 
                ship.y - 30, 
                90, 70);
        }
        
        function drawSelfie(selfie) {
            ctx.drawImage(images.camera, 
                selfie.x - 15, 
                selfie.y - 12, 
                30, 25);
        }
        
        function spawnEnemy() {
            const baseSpeed = 2;
            const speedIncrease = Math.min(gameState.difficulty * 0.5, 5);
            
            gameState.enemies.push({
                x: Math.random() * (canvas.width - 80) + 40,
                y: -40,
                speed: baseSpeed + speedIncrease + Math.random() * 2
            });
        }
        
        function spawnSelfie() {
            gameState.selfies.push({
                x: Math.random() * (canvas.width - 60) + 30,
                y: -30
            });
        }
        
        function checkCollision(rect1, rect2, size1W = 60, size1H = 40, size2W = 50, size2H = 40) {
            return rect1.x - size1W/2 < rect2.x + size2W/2 &&
                   rect1.x + size1W/2 > rect2.x - size2W/2 &&
                   rect1.y - size1H/2 < rect2.y + size2H/2 &&
                   rect1.y + size1H/2 > rect2.y - size2H/2;
        }
        
        function updateHUD() {
            document.getElementById('selfies').textContent = gameState.selfieCount;
            document.getElementById('bronceado').textContent = gameState.bronceadoPoints;
            document.getElementById('lives').textContent = gameState.lives;
            document.getElementById('immunity').textContent = gameState.immune ? 'ON' : 'OFF';
            
            // Update immunity button state
            const immunityButton = document.getElementById('immunityButton');
            const mobileControls = document.getElementById('mobileControls');
            
            const canActivate = !gameState.immune && gameState.bronceadoPoints >= 100;
            immunityButton.disabled = !canActivate;
            mobileControls.style.opacity = canActivate ? '1' : '0';
        }
        
        function gameLoop() {
            if (gameState.gameOver) return;
            
            // Clear canvas
            ctx.fillStyle = '#2f94c0';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Dibujar olas
            ctx.strokeStyle = '#2fb4d0';
            ctx.lineWidth = 2;
            for (let i = 0; i < 20; i++) {
                ctx.beginPath();
                ctx.moveTo(0, i * 40 + (Date.now() / 20) % 40);
                ctx.lineTo(canvas.width, i * 40 + (Date.now() / 20) % 40);
                ctx.stroke();
            }
            // Comprobar si ha pasado suficiente tiempo desde la √∫ltima tecla

            // Keyboard controls
            // Keyboard controls - update lastKeyPressTime for any movement key
            if (keys['ArrowLeft'] || keys['ArrowRight'] || keys['ArrowUp'] || keys['ArrowDown']) {
                lastKeyPressTime = Date.now();
            }
            
            if (keys['ArrowLeft'] && gameState.player.x > 40) {
                gameState.player.x -= gameState.player.speed;
            }
            if (keys['ArrowRight'] && gameState.player.x < canvas.width - 40) {
                gameState.player.x += gameState.player.speed;
            }
            if (keys['ArrowUp'] && gameState.player.y > 30) {
                gameState.player.y -= gameState.player.speed;
            }
            if (keys['ArrowDown'] && gameState.player.y < canvas.height - 30) {
                gameState.player.y += gameState.player.speed;
            }
            if (isPointerActive && Date.now() - lastKeyPressTime > 100) {
                // Smooth movement towards pointer
                const dx = pointerX - gameState.player.x;
                const dy = pointerY - gameState.player.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance > gameState.player.speed) {
                    const moveX = (dx / distance) * gameState.player.speed;
                    const moveY = (dy / distance) * gameState.player.speed;
                    
                    // Check boundaries
                    if ((moveX < 0 && gameState.player.x > 40) || 
                        (moveX > 0 && gameState.player.x < canvas.width - 40)) {
                        gameState.player.x += moveX;
                    }
                    if ((moveY < 0 && gameState.player.y > 30) || 
                        (moveY > 0 && gameState.player.y < canvas.height - 30)) {
                        gameState.player.y += moveY;
                    }
                }
            }
            
            // Actualizar timer de inmunidad
            if (gameState.immune) {
                gameState.immuneTimer--;
                if (gameState.immuneTimer <= 0) {
                    gameState.immune = false;
                    gameState.allyShips = [];
                    updateHUD();
                }
            }
            
            // Actualizar barcos aliados
            gameState.allyShips.forEach(ship => {
                ship.y = gameState.player.y;
                ship.x = gameState.player.x + (ship.type === 'spain' ? -100 : 100);
            });
            
            // Spawn enemigos (m√°s r√°pido con el tiempo)
            gameState.enemySpawnTimer++;
            const spawnRate = Math.max(30, 60 - gameState.difficulty * 2);
            if (gameState.enemySpawnTimer > spawnRate) {
                spawnEnemy();
                gameState.enemySpawnTimer = 0;
            }
            
            // Spawn selfies
            gameState.selfieSpawnTimer++;
            if (gameState.selfieSpawnTimer > 90) {
                spawnSelfie();
                gameState.selfieSpawnTimer = 0;
            }
            
            // Actualizar y dibujar enemigos
            gameState.enemies = gameState.enemies.filter(enemy => {
                enemy.y += enemy.speed;
                
                if (enemy.y > canvas.height) {
                    gameState.bronceadoPoints += 5;
                    gameState.enemiesAvoided++;
                    
                    // Aumentar dificultad cada 5 enemigos esquivados
                    if (gameState.enemiesAvoided % 5 === 0) {
                        gameState.difficulty+=3;
                    }
                    
                    updateHUD();
                    return false;
                }
                
                // Colisi√≥n con jugador
                if (!gameState.immune && checkCollision(gameState.player, enemy, 60, 40, 50, 40)) {
                    gameState.lives--;
                    updateHUD();
                    if (gameState.lives <= 0) {
                        endGame();
                    }
                    return false;
                }
                
                drawEnemy(enemy);
                return true;
            });
            
            // Actualizar y dibujar selfies
            gameState.selfies = gameState.selfies.filter(selfie => {
                selfie.y += 3;
                
                if (selfie.y > canvas.height) return false;
                
                // Colisi√≥n con jugador
                if (checkCollision(gameState.player, selfie, 60, 40, 25, 20)) {
                    gameState.selfieCount++;
                    updateHUD();
                    return false;
                }
                
                drawSelfie(selfie);
                return true;
            });
            
            // Dibujar barcos aliados
            gameState.allyShips.forEach(ship => drawAllyShip(ship));
            
            // Dibujar jugador
            drawPlayer();
            
            // Dibujar vidas como logos de Instagram
            for (let i = 0; i < gameState.lives; i++) {
                ctx.drawImage(images.instagramLogo, 20 + i * 50, 20, 40, 40);
            }
            
            requestAnimationFrame(gameLoop);
        }
        
        function endGame() {
            gameState.gameOver = true;
            document.getElementById('finalScore').textContent = 
                `¬°Has recolectado ${gameState.selfieCount} selfies!`;
            document.getElementById('gameOver').style.display = 'block';
        }
        
        function restartGame() {
            gameState = {
                player: { x: 400, y: 500, width: 80, height: 40, speed: 5 },
                enemies: [],
                selfies: [],
                allyShips: [],
                selfieCount: 0,
                bronceadoPoints: 0,
                lives: 3,
                immune: false,
                immuneTimer: 0,
                gameOver: false,
                score: 0,
                enemySpawnTimer: 0,
                selfieSpawnTimer: 0,
                difficulty: 1,
                enemiesAvoided: 0
            };
            
            document.getElementById('gameOver').style.display = 'none';
            updateHUD();
            gameLoop();
        }
        
        function activateImmunity() {
            if (gameState.bronceadoPoints >= 100 && !gameState.immune) {
                gameState.bronceadoPoints -= 100;
                gameState.immune = true;
                gameState.immuneTimer = 300;
                gameState.allyShips = [
                    { type: 'spain', x: gameState.player.x - 100, y: gameState.player.y },
                    { type: 'italy', x: gameState.player.x + 100, y: gameState.player.y }
                ];
                updateHUD();
            }
        }

        // Setup immunity button and spacebar
        document.getElementById('immunityButton').addEventListener('click', activateImmunity);
        
        window.addEventListener('keydown', (e) => {
            if (e.code === 'Space' && !e.repeat) {
                if (gameState.bronceadoPoints >= 100 && !gameState.immune) {
                    activateImmunity();
                }
            }
        });

        // Iniciar juego
        updateHUD();
        gameLoop();
    </script>
</body>
</html>
